<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Account Selling & Management</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <h2>üßæ MushRon and Elle's Age up</h2>
        <p style="text-align: center; font-weight: bold;">All accounts are add email no bona</p>
        <table>
            <thead>
                <tr>
                    <th>Account #</th>
                    <th>Bucks (‚Ç±1 per 1000)</th>
                    <th>Age Ups (‚Ç±1 each)</th>
                    <th>Total (‚Ç±)</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="account-table-body">
                <!-- Dynamic rows will be added here -->
            </tbody>
        </table>
        <div class="status-counts">
            <span id="available-count">‚úÖ Available: 0</span> |
            <span id="farming-count">‚è≥ Farming: 0</span> |
            <span id="sold-count">‚ùå Sold: 0</span>
        </div>
        <div class="earnings">
            <p>üßæ Total: ‚Ç±<span id="total-income">0</span></p>
            <p>‚úÖ Remaining: ‚Ç±<span id="available-income">0</span></p>
            <p>‚è≥ On Hold: ‚Ç±<span id="farming-income">0</span></p>
            <p>‚ùå Earned: ‚Ç±<span id="sold-income">0</span></p>
        </div>

        <button onclick="addRow()">‚ûï Add Account</button>
    </div>

    <button onclick="clearAll()" class="clear">üóëÔ∏è Clear All</button>

    <script>let accountCount = 1;

// Load saved data from localStorage
window.onload = () => {
  const savedAccounts = JSON.parse(localStorage.getItem("accounts")) || [];
  if (savedAccounts.length > 0) {
    savedAccounts.forEach(account => {
      addRow(account.bucks, account.ageUps, account.accountNumber, account.status);
    });
    accountCount = savedAccounts.length + 1;
  } else {
    addRow();
  }
};

// Add a new row with a unique account number and optional status
function addRow(bucks = 0, ageUps = 0, accountNumber = `ACC-${accountCount++}`, status = 'available') {
  const tableBody = document.getElementById("account-table-body");
  const row = document.createElement("tr");
  row.classList.add(status); // Apply the status color class

  row.innerHTML = `
    <td>${accountNumber}</td>
    <td>
      <input type="text" value="${formatNumber(bucks)}"
        oninput="liveFormat(this)" onblur="formatDisplay(this)" onfocus="removeCommas(this)">
    </td>
    <td>
      <input type="number" min="0" value="${ageUps}" oninput="saveAndCalculate()">
    </td>
    <td class="row-total">‚Ç±0</td>
    <td>
      <button onclick="setStatus(this, 'available')">‚úÖ</button>
      <button onclick="setStatus(this, 'farming')">‚è≥</button>
      <button onclick="setStatus(this, 'sold')">‚ùå</button>
    </td>
  `;

  tableBody.appendChild(row);
  saveAndCalculate();
}

// Set status and update row style
function setStatus(button, newStatus) {
  const row = button.closest('tr');
  row.classList.remove('available', 'farming', 'sold');
  row.classList.add(newStatus);
  saveAndCalculate(); // Save updated status to localStorage
}

// Format number with commas
function formatNumber(value) {
  return Number(value).toLocaleString('en-US');
}

// Format value while typing
function liveFormat(input) {
  let raw = input.value.replace(/,/g, '').replace(/[^\d]/g, '');
  if (raw === '') return;
  input.value = formatNumber(raw);
  saveAndCalculate();
}

// Remove commas on focus
function removeCommas(input) {
  input.value = input.value.replace(/,/g, '');
}

// Final format on blur
function formatDisplay(input) {
  const raw = input.value.replace(/,/g, '');
  if (raw && !isNaN(raw)) {
    input.value = formatNumber(raw);
  }
}

// Save all data and calculate totals and earnings
function saveAndCalculate() {
  const rows = document.querySelectorAll("#account-table-body tr");
  const accounts = [];
  let totalIncome = 0;
  let availableIncome = 0;
  let farmingIncome = 0;
  let soldIncome = 0;

  let availableCount = 0;
  let farmingCount = 0;
  let soldCount = 0;

  rows.forEach(row => {
    const accountNumber = row.children[0].textContent;
    const bucksInput = row.children[1].querySelector("input");
    const ageUpsInput = row.children[2].querySelector("input");
    const rowTotalCell = row.querySelector(".row-total");

    const bucks = parseInt(bucksInput.value.replace(/,/g, '')) || 0;
    const ageUps = parseInt(ageUpsInput.value) || 0;

    const bucksCost = Math.floor(bucks / 1000);
    const ageUpsCost = ageUps;
    const rowTotal = bucksCost + ageUpsCost;

    rowTotalCell.textContent = `‚Ç±${rowTotal}`;
    totalIncome += rowTotal;

    const status = row.classList.contains('sold')
      ? 'sold'
      : row.classList.contains('farming')
      ? 'farming'
      : 'available';

    if (status === 'available') {
      availableCount++;
      availableIncome += rowTotal;
    }
    if (status === 'farming') {
      farmingCount++;
      farmingIncome += rowTotal;
    }
    if (status === 'sold') {
      soldCount++;
      soldIncome += rowTotal;
    }

    accounts.push({ accountNumber, bucks, ageUps, status });
  });

  // Save to localStorage
  localStorage.setItem("accounts", JSON.stringify(accounts));

  // Update counters
  document.getElementById("available-count").textContent = `‚úÖ Available: ${availableCount}`;
  document.getElementById("farming-count").textContent = `‚è≥ Farming: ${farmingCount}`;
  document.getElementById("sold-count").textContent = `‚ùå Sold: ${soldCount}`;

  // Update earnings
  document.getElementById("total-income").textContent = totalIncome;
  document.getElementById("available-income").textContent = availableIncome;
  document.getElementById("farming-income").textContent = farmingIncome;
  document.getElementById("sold-income").textContent = soldIncome;
}

// Clear all rows and reset
function clearAll() {
  localStorage.removeItem("accounts");
  document.getElementById("account-table-body").innerHTML = '';
  accountCount = 1;

  // Reset counts
  document.getElementById("available-count").textContent = `‚úÖ Available: 0`;
  document.getElementById("farming-count").textContent = `‚è≥ Farming: 0`;
  document.getElementById("sold-count").textContent = `‚ùå Sold: 0`;

  document.getElementById("total-income").textContent = '0';
  document.getElementById("available-income").textContent = '0';
  document.getElementById("farming-income").textContent = '0';
  document.getElementById("sold-income").textContent = '0';

  addRow();
}
</script>
</body>

</html>
